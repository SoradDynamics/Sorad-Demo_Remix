const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leaflet-src-V2rtdhkS.js","assets/index-LyWbo2uX.js","assets/server.browser-DH0-pdKd.js","assets/index-XMzq6P1j.js"])))=>i.map(i=>d[i]);
import{_ as m}from"./_index-BzKagXI0.js";import{r,j as u}from"./index-LyWbo2uX.js";import"./appwrite-CYiyTo-W.js";import"./components-D5P0CXfE.js";import"./index-XMzq6P1j.js";import"./createLucideIcon-JsGswnLl.js";import"./Drawer-DcM_eh-v.js";import"./nepali-date-converter.es5-D9pCTyGn.js";import"./index-MYBBOcXX.js";import"./resizeResults-DPF4xKo6.js";const K=({color:h="currentColor",size:f=24,className:g=""})=>u.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:h,stroke:"black",strokeWidth:"1",viewBox:"0 0 24 24",style:{width:f,height:f},className:g,children:u.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-4.28 0-7.75 3.47-7.75 7.75 0 6.21 7.17 11.27 7.48 11.47a.75.75 0 0 0 .54.03c.31-.1 7.48-5.26 7.48-11.5 0-4.28-3.47-7.75-7.75-7.75Zm0 10.5a2.75 2.75 0 1 1 0-5.5 2.75 2.75 0 0 1 0 5.5Z",clipRule:"evenodd"})});let a=null,w=null,N=null;const ne=({locations:h,colors:f,center:g=[20.5937,78.9629],zoom:M=5,currentDriverId:c,fitBounds:b=!1})=>{const E=r.useRef(null),o=r.useRef(null),S=r.useRef({}),[s,P]=r.useState(!1),[I,T]=r.useState(!1),[k,V]=r.useState(!1),z=r.useRef({});r.useEffect(()=>((async()=>{try{const[t,y,p,L,d]=await Promise.all([m(()=>import("./leaflet-src-V2rtdhkS.js").then(n=>n.l),__vite__mapDeps([0,1])),m(()=>import("./server.browser-DH0-pdKd.js").then(n=>n.s),__vite__mapDeps([2,1,3])),m(()=>import("./marker-icon-2x-D4k_ikNW.js"),[]),m(()=>import("./marker-icon-C2eJqgqv.js"),[]),m(()=>import("./marker-shadow-DU6CIJ0p.js"),[])]);a=t.default,w=y,N=a.icon({iconRetinaUrl:p.default,iconUrl:L.default,shadowUrl:d.default,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}),P(!0),T(!0),V(!0)}catch(t){console.error("MapDisplay: Failed to load Leaflet or ReactDOMServer:",t)}})(),()=>{o.current&&(o.current.remove(),o.current=null),S.current={}}),[]);const O=r.useCallback(e=>{if(!a||!w||!I)return console.warn("MapDisplay: Cannot create DriverDivIcon - Leaflet/ReactDOMServer not loaded."),null;try{const t=w.renderToString(u.jsx(K,{color:e,size:50}));return a.divIcon({html:t,className:"",iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]})}catch(t){return console.error("MapDisplay: Error rendering icon for Leaflet:",t),null}},[I]),l=r.useMemo(()=>{const e=new Map;return h.forEach(t=>e.set(t.id,t)),e},[h]);r.useEffect(()=>{if(!s||!E.current||o.current)return;let e=null;try{if(!a)throw new Error("Leaflet is not initialized");e=a.map(E.current).setView(g,M),o.current=e,a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(e)}catch(t){console.error("Error initializing map:",t);return}},[s,g,M]),r.useEffect(()=>{if(!s||!k||!o.current||!w||!a)return;const e=o.current,t=S.current,y=new Set(Object.keys(t)),p=a.latLngBounds([]);let L=!1;const d=z.current;l.forEach((n,i)=>{const{latitude:R,longitude:_,driverName:U,timestamp:j}=n;if(typeof R!="number"||typeof _!="number"||isNaN(R)||isNaN(_)){console.warn(`MapDisplay: Invalid coordinates for location ID ${i}`);return}const D=`${R},${_}`;d[D]=(d[D]||0)+1;const A=d[D]*1e-4,Z=R+A,B=_+A,x=[Z,B],C=`<b>${U||`Driver ${i.substring(0,6)}`}</b><br/>${j?`Last Seen: ${new Date(j).toLocaleString()}`:""}${c===i?"<br/><i>(You)</i>":""}`,F=f[i],v=O(F)||N;if(t[i]&&v)t[i].setLatLng(x).setPopupContent(C).setIcon(v);else if(a&&v){const H=a.marker(x,{icon:v}).addTo(e).bindPopup(C);t[i]=H}y.delete(i),p.extend(x),L=!0}),y.forEach(n=>{t[n]&&(e.removeLayer(t[n]),delete t[n])}),b&&L&&p.isValid()?e.fitBounds(p,{padding:[50,50]}):b&&l.size===1&&l.forEach(n=>e.setView([n.latitude,n.longitude],15))},[s,k,l,c,b,f,O]),r.useEffect(()=>{if(c&&s&&o.current){const e=l.get(c);e&&o.current.flyTo([e.latitude,e.longitude],15)}},[c,l,s]);const $=()=>{if(c&&s&&o.current){const e=l.get(c);e&&o.current.flyTo([e.latitude,e.longitude],15)}};return u.jsxs("div",{ref:E,className:"h-full w-full bg-gray-300 relative",children:[!s&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-300 bg-opacity-50",children:"Loading Map..."}),s&&o.current&&u.jsx("button",{className:"absolute top-2 left-2 bg-white bg-opacity-75 hover:bg-opacity-90 text-gray-700 rounded p-2 shadow-md z-10",onClick:$,children:"Zoom to Current Location"})]})};export{ne as default};
